version: '3.8'

services:
  claude-orchestration:
    build:
      context: .
      target: production
    image: claude-code-orchestration:latest
    container_name: claude-orchestration
    volumes:
      # Mount session storage
      - ./sessions:/app/sessions
      # Mount logs
      - ./logs:/app/logs
      # Mount config (read-only)
      - ./config:/app/config:ro
    environment:
      - PYTHONUNBUFFERED=1
      - CLAUDE_CODE_ENV=production
    networks:
      - claude-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python3", "-c", "from src.config_loader import load_config; load_config()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  claude-network:
    driver: bridge

volumes:
  sessions:
  logs:
